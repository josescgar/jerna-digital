---
import { getTranslations } from '@/i18n/translations';
import Logo from './Logo.astro';

const t = getTranslations();

interface NavItem {
  label: string;
  href: string;
}

const navItems: NavItem[] = [
  { label: t.nav.about, href: '/about' },
  { label: t.nav.services, href: '/services' },
  { label: t.nav.caseStudies, href: '/case-studies' },
  { label: t.nav.contact, href: '/contact' },
];
---

<header class="fixed top-0 right-0 left-0 z-30" id="site-header">
  <div class="glass">
    <nav class="container flex h-16 items-center justify-between md:h-20">
      <a
        href="/"
        class="flex items-center gap-2 transition-opacity hover:opacity-80"
        aria-label={t.site.name}
      >
        <Logo />
      </a>

      <!-- Desktop Navigation -->
      <ul class="hidden items-center gap-1 md:flex">
        {
          navItems.map((item) => (
            <li>
              <a
                href={item.href}
                class="text-foreground-muted hover:bg-background-subtle hover:text-foreground rounded-lg px-4 py-2 text-sm font-medium transition-colors"
              >
                {item.label}
              </a>
            </li>
          ))
        }
        <li class="ml-4">
          <a
            href="/contact"
            class="bg-gradient-primary text-primary-foreground hover:shadow-glow inline-flex h-10 items-center justify-center rounded-lg px-5 text-sm font-medium transition-all hover:scale-[1.02]"
          >
            {t.hero.cta}
          </a>
        </li>
      </ul>

      <!-- Mobile Menu Button -->
      <button
        type="button"
        class="text-foreground-muted hover:bg-background-subtle hover:text-foreground flex h-10 w-10 items-center justify-center rounded-lg transition-colors md:hidden"
        id="mobile-menu-btn"
        aria-label="Toggle menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="menu-icon"
        >
          <line x1="4" x2="20" y1="12" y2="12"></line>
          <line x1="4" x2="20" y1="6" y2="6"></line>
          <line x1="4" x2="20" y1="18" y2="18"></line>
        </svg>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="close-icon hidden"
        >
          <path d="M18 6 6 18"></path>
          <path d="m6 6 12 12"></path>
        </svg>
      </button>
    </nav>
  </div>

  <!-- Mobile Menu -->
  <div
    class="glass relative z-50 hidden md:hidden"
    id="mobile-menu"
    aria-hidden="true"
  >
    <nav class="container py-4">
      <ul class="flex flex-col gap-2">
        {
          navItems.map((item) => (
            <li>
              <a
                href={item.href}
                class="text-foreground-muted hover:bg-background-subtle hover:text-foreground block rounded-lg px-4 py-3 text-base font-medium transition-colors"
              >
                {item.label}
              </a>
            </li>
          ))
        }
        <li class="mt-2">
          <a
            href="/contact"
            class="bg-gradient-primary text-primary-foreground hover:shadow-glow flex h-12 items-center justify-center rounded-lg text-base font-medium transition-all"
          >
            {t.hero.cta}
          </a>
        </li>
      </ul>
    </nav>
  </div>
</header>

<script>
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = menuBtn?.querySelector('.menu-icon');
  const closeIcon = menuBtn?.querySelector('.close-icon');

  function toggleMenu(): void {
    const isExpanded = menuBtn?.getAttribute('aria-expanded') === 'true';

    menuBtn?.setAttribute('aria-expanded', String(!isExpanded));
    mobileMenu?.classList.toggle('hidden');
    mobileMenu?.setAttribute('aria-hidden', String(isExpanded));
    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');

    // Prevent body scroll when menu is open
    document.body.style.overflow = isExpanded ? '' : 'hidden';
  }

  menuBtn?.addEventListener('click', toggleMenu);

  // Close menu on escape key
  document.addEventListener('keydown', (e) => {
    if (
      e.key === 'Escape' &&
      menuBtn?.getAttribute('aria-expanded') === 'true'
    ) {
      toggleMenu();
    }
  });

  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    const target = e.target as Node;
    if (
      menuBtn?.getAttribute('aria-expanded') === 'true' &&
      !mobileMenu?.contains(target) &&
      !menuBtn?.contains(target)
    ) {
      toggleMenu();
    }
  });
</script>
